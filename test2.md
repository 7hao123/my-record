# BI 低代码可视化画布项目亮点分析（面试向·技术细节增强版）

## 项目一句话定位（BI 低代码）
以「指标/维度建模 + 配置驱动渲染」为核心的 BI 低代码平台：将报表页面抽象为可持久化的 Box Schema，并提供可视化画布编排、指标筛选、钻取分析与图表/表格渲染能力，让业务与分析同学通过配置完成报表与看板交付。

---

## 业务价值（Why it matters · BI 视角）
传统 BI 报表交付依赖工程师反复拼装图表、表格和筛选条件，导致交付周期长、改动成本高、分析迭代慢。该项目把“数据语义（指标/维度）+ 页面结构 + 交互联动”统一协议化，实现从“手写报表”到“配置化搭建”的转型，使分析团队能自助搭建看板、快速验证业务假设。

---

## 架构抽象与分层设计（BI 低代码特征）
1) **画布交互层（Editor Runtime）**
- 负责组件选中/框选/拖拽/缩放/旋转/对齐/分组等交互逻辑
- 技术实现：`react-moveable` + `react-selecto`，支持多选框选、吸附与对齐线、组合移动/缩放
- 交互状态统一进入 Redux（`editorSlice`）做集中管理，支持撤销/重做

2) **渲染运行层（Runtime Renderer）**
- 渲染只消费 `boxList`（Schema 实例），按几何与配置渲染组件
- `BoxContent` 做运行时派发，组件 self‑contained（自管理数据请求与渲染）

3) **物料协议层（Material Meta）**
- `boxTypes` 统一定义：默认尺寸、配置结构、数据约束、可切换类型、chartConfig/tableConfig
- 新增物料只需注册，画布核心不改，符合 BI 平台“插件化扩展”范式

4) **BI 数据语义层（指标/维度/筛选）**
- 指标、维度、筛选条件被标准化进入 Box 配置
- `requestableCheckers` 对维度/指标数量做约束，保证请求合法性
- `useRequestParams` 统一拼装 BI 请求参数（时间范围、维度筛选、指标、排序、钻取、同比/环比）

5) **资源/模板复用层**
- 支持“资源”概念（单组件/组合组件），可保存并复用
- `useResource` 负责资源加载注入画布，形成可沉淀的 BI 资产

6) **预览/导出能力**
- 预览模式独立运行时，支持适屏/适宽/原始比例
- 导出 PDF 使用 `snapdom + jsPDF`，结合组件边界做分页切割，避免组件被截断

---

## 关键技术细节（偏 BI 低代码）

### 1) 画布交互能力的工程化实现
- **交互引擎**：`react-moveable` 提供拖拽/缩放/旋转；`react-selecto` 实现多选框选
- **吸附与对齐**：Moveable 的 `elementGuidelines` + snap 方向实现组件对齐
- **分组能力**：通过 `combinationId` 管理组合组件，组内拖拽/缩放统一更新
- **快捷操作**：Delete 删除、Ctrl+C/V 复制粘贴，方向键微调

### 2) BI 数据请求统一入口
- `useBoxData` 统一处理占位数据、加载态、错误态、空数据态
- `useRequestParams` 聚合 BI 请求条件：筛选器、钻取条件、维度成员、同比/环比参数
- API 请求集中由 `getReportData` 触发，QueryKey 统一管理

### 3) 指标/维度驱动的交互分析
- 维度/指标配置直接绑定到图表/表格组件
- 钻取通过 ECharts 点击事件触发，自动切换 active 维度并驱动数据刷新
- 支持维度筛选组件、指标筛选组件作为分析入口

### 4) Schema → 渲染的运行时流程
- 报表接口返回 `views`（configData JSON），解析后注入 `boxList`
- 运行时仅依赖 `boxList` + `canvas`，与业务 API 解耦，符合“配置即页面”

### 5) BI 组件体系的扩展与复用
- 图表类：折线、柱状、饼图、双轴、仪表盘、瀑布图等
- 表格类：明细表、分组表、数据表，并支持条件格式化与链接跳转
- 组件类型切换 `switchBoxType` 支持配置迁移

### 6) 复杂容器嵌套（Tabs）
- 组件拖入 Tabs 容器时通过 `isInside` 自动绑定 `tabsId/paneId`
- `useBoxList` 控制容器内可见性，实现“容器级布局管理”

### 7) 导出能力与分页算法
- 导出时先计算每个组件边界，分页时优先靠近组件边界切割
- 避免图表/表格被截断，优化 BI 报表交付体验

---

## 技术难点 & 解决方案（BI 低代码高频问法）

### 难点 1：BI 语义（指标/维度）与可视化组件的解耦
- **挑战**：图表/表格必须理解指标语义，但画布不能绑定具体业务逻辑
- **方案**：指标/维度作为配置进入 Box，组件只消费标准化配置
- **收益**：语义层与渲染层分离，支持横向扩展新图表/新表格

### 难点 2：复杂分析条件的统一拼装
- **挑战**：筛选、钻取、时间范围、同比/环比、排序组合复杂
- **方案**：集中到 `useRequestParams` 生成 API 参数
- **收益**：避免每个组件重复拼装逻辑，减少错误率

### 难点 3：交互态与编辑态状态爆炸
- **挑战**：多选、拖拽、缩放、组合与编辑态互相干扰
- **方案**：Redux 统一状态管理 + Moveable/Selecto 统一交互触发
- **收益**：交互逻辑可预测，可撤销，降低回归风险

### 难点 4：图表/表格配置演进的兼容
- **挑战**：图表类型切换或配置升级时旧报表易失效
- **方案**：`boxTypes` 作为物料协议入口，`switchBoxType` 做配置迁移
- **收益**：保证历史报表可用，降低升级成本

### 难点 5：BI 报表导出的可用性
- **挑战**：复杂看板导出时常出现组件被截断
- **方案**：分页算法结合组件边界计算切点
- **收益**：导出可读性强，接近企业级 BI 产品体验

---

## 对齐主流 BI 低代码平台能力映射
- **指标/维度驱动**：组件围绕指标/维度配置驱动
- **配置驱动渲染**：Schema/Box 驱动页面渲染
- **物料插件化**：boxTypes 注册机制支持扩展
- **分析交互**：筛选、钻取、联动、同比/环比
- **资产复用**：组件/组合组件可保存为资源
- **平台化扩展方向**：权限体系、版本管理、多人协作、模板市场、灰度发布

---

## 面试可直接讲的 BI 亮点关键词
- BI 低代码：指标/维度建模 + 配置驱动
- Moveable + Selecto 的画布交互引擎
- Redux + redux‑undo 的可回放编辑状态
- Chart 通用渲染基座 + Drilldown 驱动
- 统一查询参数拼装（筛选/钻取/同比环比）
- 导出分页算法与报表体验优化
- 资源化复用与平台化扩展
