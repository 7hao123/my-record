# 低代码可视化画布项目亮点分析（面试向·技术细节增强版）

## 项目一句话定位
以「配置驱动 + 可视化编排」为核心，将报表页面抽象为可持久化的 Box Schema，通过画布交互层完成编排，通过运行时渲染层完成展示，实现从“手写页面”到“配置化搭建”的转变。

---

## 业务价值（Why it matters）
传统报表开发需要前端反复拼装布局、图表、表格和筛选条件，变更成本高且依赖工程师介入。该项目将页面结构、组件配置、数据联动都“协议化”，让非技术同学可通过拖拽与配置快速生成页面，并支持复用、模板化与快速迭代。

---

## 架构抽象与分层设计（高层设计能力）
1) **画布交互层（Editor Runtime）**
- 负责组件选中/框选/拖拽/缩放/旋转/对齐/分组等交互逻辑
- 技术实现：`react-moveable` + `react-selecto`，支持多选框选、吸附与对齐线、组合移动/缩放
- 交互状态统一进入 Redux（`editorSlice`）做集中管理，保证可回放、可撤销

2) **渲染运行层（Runtime Renderer）**
- 渲染只消费 `boxList`，按 Schema 的几何与配置渲染组件
- `BoxContent` 用组件映射表做运行时派发，所有组件均为 self‑contained（自管理数据获取和渲染）

3) **物料协议层（Material Meta）**
- 统一的 `boxTypes` 元信息定义：默认尺寸、配置结构、数据约束、可切换类型、图表配置（chartConfig/tableConfig）
- 新增组件只需注册物料 + 配置，画布核心不改，具备插件化扩展思路

4) **数据与查询层**
- React Query 负责数据请求与缓存，统一 QueryKey；组件通过 `useBoxData` 获取数据
- `useRequestParams` 统一组装 API 请求参数（时间范围、维度筛选、指标、排序、钻取、同比环比）

5) **资源/模板复用层**
- 支持“资源”概念（单组件/组合组件），选中后可保存为资源并复用
- `useResource` 负责资源加载并注入画布，提高复用率

6) **预览/导出能力**
- 预览模式独立运行时，通过 viewMode 控制适屏/适宽/原始比例
- 导出 PDF 使用 `snapdom + jsPDF`，并用组件边界做分页切割，避免组件被截断

---

## 关键技术细节（可直接面试回答）

### 1) 画布交互能力的工程化实现
- **交互引擎**：`react-moveable` 提供拖拽/缩放/旋转；`react-selecto` 实现多选框选
- **吸附与对齐**：Moveable 的 `elementGuidelines` + snap 方向实现组件对齐
- **分组能力**：通过 `combinationId` 管理组合组件，组内拖拽/缩放统一更新
- **快捷操作**：Delete 删除、Ctrl+C/V 复制粘贴（本地缓存），方向键微调

### 2) 状态与撤销/重做机制
- 单一状态源 `editorSlice` 管理 `canvas + boxList`
- 引入 `redux-undo`，支持撤销/重做，显著提升编辑体验

### 3) 组件协议与配置驱动
- 所有组件以 `boxTypes` 统一描述：尺寸、title、图表配置、表格配置、可切换类型
- 通过 `requestableCheckers` 约束维度/指标的数量与合法性，避免非法配置请求
- `switchBoxType` 实现图表类型切换时的配置迁移（保留公共字段，替换 chartConfig/tableConfig）

### 4) Schema → 渲染的运行时流程
- 报表接口返回 `views`（configData JSON），解析后直接注入 `boxList`
- 运行时仅依赖 `boxList` 和 `canvas`，与具体业务 API 解耦

### 5) 数据请求抽象
- `useBoxData` 统一处理占位数据、加载态、错误态、空数据态
- `useRequestParams` 聚合过滤条件：筛选器、钻取条件、维度成员、同比/环比参数
- 钻取逻辑通过 ECharts 事件触发，自动修改维度 active 状态并驱动数据更新

### 6) 复杂容器嵌套（Tabs）
- 组件拖入 Tabs 容器时通过 `isInside` 自动绑定 `tabsId/paneId`
- Tabs 切换由 `useBoxList` 过滤可见组件，实现“容器级可见性控制”

### 7) 导出能力与分页算法
- 导出时先计算每个组件的边界，分页时优先靠近组件边界切割
- 减少组件被截断，提高可用性（属于工程体验细节）

---

## 技术难点 & 解决方案（含“高含金量”表达）

### 难点 1：画布高交互状态管理（多选/拖拽/缩放/组合）
- **挑战**：交互状态多且相互影响，容易产生状态污染
- **方案**：交互状态集中到 Redux + 组合 ID 管理；框选由 Selecto 统一驱动；交互结果只写入 boxList
- **收益**：交互逻辑可预测、可撤销，避免 UI 与状态脱节

### 难点 2：组件与画布的解耦
- **挑战**：画布要管理交互，但不应干预组件渲染逻辑
- **方案**：Box 只包含几何信息与配置；组件 self‑contained，负责数据请求与渲染
- **收益**：画布可扩展，业务组件可独立演进

### 难点 3：配置驱动的兼容与扩展
- **挑战**：新增组件或改配置时不能影响已有页面
- **方案**：以 boxTypes 作为统一物料协议入口；用 chartConfig/tableConfig 隔离不同类型的配置
- **收益**：新增物料成本低，兼容性可控

### 难点 4：数据请求的统一与复杂条件拼装
- **挑战**：维度筛选、钻取、时间范围、排序、同比/环比组合复杂
- **方案**：集中到 `useRequestParams` 生成 API 参数，组件不重复拼装请求
- **收益**：减少重复逻辑，降低出错率，便于治理

### 难点 5：导出报表的视觉完整性
- **挑战**：直接截图分页会切断组件
- **方案**：分页时结合组件边界计算最佳切点
- **收益**：导出体验显著提升，是“细节工程化”的体现

---

## 对齐主流低代码方案的能力映射
- **配置驱动**：页面由 Schema 描述，支持“配置即页面”的低代码核心范式
- **物料插件化**：boxTypes 统一定义物料元信息，天然支持扩展
- **运行时可复用**：资源保存/复用，接近主流平台的“模板化”能力
- **多运行时模式**：编辑态/预览态分离，支持适屏/适宽模式
- **平台化扩展方向**（可作为面试追问的未来规划）：权限体系、版本管理、多人协作、模板市场、灰度发布

---

## 面试可直接讲的亮点关键词
- 配置驱动 Schema / boxTypes 物料协议
- Moveable + Selecto 的画布交互引擎
- Redux + redux‑undo 的可回放编辑状态
- Chart 通用渲染基座 + Drilldown 驱动
- 预览运行时 + PDF 导出分页算法
- 资源化复用与平台化扩展
